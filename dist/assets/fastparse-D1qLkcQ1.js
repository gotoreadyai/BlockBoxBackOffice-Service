function t(){}function e(t){this.states=this.compileStates(t)}e.prototype.compileStates=function(t){var e={};return Object.keys(t).forEach((function(r){e[r]=this.compileState(t[r],t)}),this),e},e.prototype.compileState=function(r,o){var n=[];!function t(r){if(Array.isArray(r))r.forEach(t);else if("object"==typeof r)Object.keys(r).forEach((function(t){var o,a;o=t,a=r[t],n.push({groups:e.getGroupCount(o),regExp:o,value:a})}));else{if("string"!=typeof r)throw new Error("Unexpected 'state' format");t(o[r])}}(r);var a=n.map((function(t){return"("+t.regExp+")"})).join("|"),p=[],s=1;return n.forEach((function(e){var r,o;"function"==typeof e.value?r=e.value:"string"==typeof e.value?(o=e.value,r=function(){return o}):r=t,p.push({name:e.regExp,fn:r,pos:s,pos2:s+e.groups+1}),s+=e.groups+1})),{regExp:new RegExp(a,"g"),actions:p}},e.getGroupCount=function(t){return new RegExp("("+t+")|^$").exec("").length-2},e.prototype.parse=function(t,e,r){r=r||{};for(var o=t,n=0;;){var a=this.states[o],p=a.regExp;p.lastIndex=n;var s=p.exec(e);if(!s)return r;var i=a.actions;n=a.regExp.lastIndex;for(var c=0;c<i.length;c++){var f=i[c];if(s[f.pos]){var u=f.fn.apply(r,Array.prototype.slice.call(s,f.pos,f.pos2).concat([a.regExp.lastIndex-s[0].length,s[0].length]));if(u){if(!(u in this.states))throw new Error("State '"+u+"' doesn't exist");o=u}break}}}};var r=e;export{r as P};
